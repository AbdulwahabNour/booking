{{template "base" .}}


{{define "content"}}

<div class="container">

    {{$rooms := index .Data "rooms"}}
    {{$links := index .Data "links"}}
    {{$last := index .IntMap "pageNumber"}}
<div class="rooms">
 <div class="row">
        <h1 class="text-center">Rooms</h1>

        {{range $rooms}}
         <div class="card">
                <h5 class="card-header">Room name : {{.RoomName}}</h5>
                <div class="card-body">
                    <div>
                          <button  onclick="showPopup('{{.ID}}')" class=" btn btn-success">Check Availability</button>
                    </div>
                </div>
       </div>

        {{end}}

        <div class="pagination">

            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">

                    <li class="page-item disabled">
                    <li class="page-item"><a class="page-link" href="/rooms/1">1</a>
                    </li>
                    {{range $links}}
                    <li class="page-item"><a class="page-link" href="/rooms/{{.}}">{{.}}</a>
                    </li>
                    {{end}}

                    <li class="page-item"><a class="page-link" href="/rooms/{{$last}}">{{$last}}</a>


                </ul>
            </nav>
        </div>
    </div>
</div>
   
</div>
{{end}}

{{define "css"}}
<link rel="stylesheet" href="/static/css/datepicker-bs5.min.css">
<link rel="stylesheet" type="text/css" href="/static/css/notie.min.css">
{{end}}

{{define "js"}}
<script src="/static/js/datepicker-full.min.js"></script>
<script src="/static/js/sweetalert2@11.js"></script>
<script src="/static/js/notie.js"></script>
<script src="/static/js/reservation.js"></script>
<script>


 

 function showPopup(room) {
    
     let form = `
            <form id="check-availabilty" action="" method="POST" class="needs-validation"  novalidate>
            <div calss="form-row">

                        <div class="container">

                                <div  class="row "  id ="date-range-modal">

                                        <div class="col">

                                        <input type="text" id="start" class="form-control" id="swal-input1" name="start_date" required autocomplete="off" disabled>
                                        </div>

                                        <div class="col">
                                        <input type="text" id="end" class="form-control" id="swal-input2" name="end_date" required autocomplete="off" disabled>
                                        </div>

                                </div>  
                        </div>
            </div>

            </form>`;

          attention.custom({
            msg: form,
            title: "Choose your dates",
            callback: function (result) {

                let form = document.getElementById("check-availabilty")
                let formData = new FormData(form)
                formData.append("csrf_token", "{{.CSRFToken}}")
                formData.append("room", room )
                console.log(form)

                fetch("/search-availability-json", { method: "post", body: formData })
                    .then(r => r.json())
                    .then(data => {
                        if (data.ok) {
                            attention.success({msg:"you will redirect to reservation page in 3 second", title : data.message,})
                            from = formData.get("start_date")
                            to = formData.get("end_date")
                            redirectAfterDelay( window.location.origin + "/make-reservation/"+from+"/"+to+"/"+room ,3000)
                        }else{
                            attention.error({title : data.message,})
                        }

          
                    })
            },
            willOpen: () => {
                const elem = document.getElementById('date-range-modal');
                const rangepicker = new DateRangePicker(elem, { format: "yyyy-mm-dd", orientation: "top auto", minDate: new Date(), autohide: true });


            },
            didOpen: () => {
                document.getElementById("start").removeAttribute('disabled')
                document.getElementById("end").removeAttribute('disabled')
            },
            preConfirm: () => {
                return [
                    document.getElementById('start').value,
                    document.getElementById('end').value
                ]
            },

        })



 }
 
</script>


{{end}}